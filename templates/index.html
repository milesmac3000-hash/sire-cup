{% extends "base.html" %}

{% block title %}{{ agenda.title }} | Sire Cup{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="gradient-bg rounded-3xl p-8 md:p-12 mb-8 relative overflow-hidden shadow-2xl">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-10 right-10 w-64 h-64 rounded-full border-2 border-white"></div>
        <div class="absolute bottom-10 left-10 w-48 h-48 rounded-full border-2 border-white"></div>
        <div class="absolute top-1/2 left-1/2 w-96 h-96 rounded-full border border-white transform -translate-x-1/2 -translate-y-1/2"></div>
    </div>
    
    <div class="relative z-10">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <div>
                <p class="text-masters-gold font-semibold text-sm uppercase tracking-widest mb-2">
                    <i class="fas fa-trophy mr-2"></i>The Annual Showdown
                </p>
                <h1 class="font-display text-4xl md:text-5xl lg:text-6xl text-white font-bold leading-tight">
                    {{ agenda.title.split(' - ')[0] if ' - ' in agenda.title else agenda.title }}
                </h1>
            </div>
            <a href="{{ url_for('edit_trip_info') }}" class="mt-4 md:mt-0 px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-xl transition-all flex items-center space-x-2">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>
        
        <div class="flex flex-wrap items-center gap-6 text-white/90 mb-8">
            <div class="flex items-center">
                <i class="fas fa-calendar-alt mr-2 text-masters-gold"></i>
                <span>{{ agenda.dates }}</span>
            </div>
            <div class="flex items-center">
                <i class="fas fa-map-marker-alt mr-2 text-masters-gold"></i>
                <span>{{ agenda.location }}</span>
            </div>
            <div class="flex items-center">
                <i class="fas fa-users mr-2 text-masters-gold"></i>
                <span>{{ players|length }} Players</span>
            </div>
        </div>
        
        <!-- Countdown Timer -->
        <div class="glass rounded-2xl p-6 inline-block">
            <p class="text-masters-green text-sm font-semibold uppercase tracking-wide mb-3">Countdown to Tee Time</p>
            <div id="countdown" class="flex items-center space-x-4">
                <div class="text-center">
                    <div class="text-4xl md:text-5xl font-bold text-masters-green" id="days">--</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Days</div>
                </div>
                <div class="text-2xl text-gray-300">:</div>
                <div class="text-center">
                    <div class="text-4xl md:text-5xl font-bold text-masters-green" id="hours">--</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Hours</div>
                </div>
                <div class="text-2xl text-gray-300">:</div>
                <div class="text-center">
                    <div class="text-4xl md:text-5xl font-bold text-masters-green" id="minutes">--</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Mins</div>
                </div>
                <div class="text-2xl text-gray-300">:</div>
                <div class="text-center">
                    <div class="text-4xl md:text-5xl font-bold text-masters-gold" id="seconds">--</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Secs</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Team Standings Card -->
{% set team_names = agenda.get_team_names_list() %}
{% if matches|length > 0 or team1_points > 0 or team2_points > 0 %}
<a href="{{ url_for('matches') }}" class="block glass rounded-2xl p-6 mb-8 border border-gray-100 card-hover">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-800">
            <i class="fas fa-trophy text-masters-gold mr-2"></i>Team Standings
        </h3>
        <span class="text-masters-green text-sm font-medium">{{ matches|selectattr('status', 'equalto', 'completed')|list|length }} matches played â†’</span>
    </div>
    <div class="flex items-center justify-center space-x-8">
        <div class="text-center">
            <div class="text-4xl font-bold text-masters-green">{{ team1_points }}</div>
            <p class="text-sm text-gray-500 mt-1">{{ team_names[0] if team_names|length > 0 else 'Team 1' }}</p>
        </div>
        <div class="text-2xl text-gray-300">-</div>
        <div class="text-center">
            <div class="text-4xl font-bold text-masters-gold">{{ team2_points }}</div>
            <p class="text-sm text-gray-500 mt-1">{{ team_names[1] if team_names|length > 1 else 'Team 2' }}</p>
        </div>
    </div>
    {% set total = team1_points + team2_points %}
    {% if total > 0 %}
    <div class="mt-4 h-2 bg-gray-200 rounded-full overflow-hidden flex">
        <div class="bg-masters-green h-full" style="width: {{ (team1_points / total * 100)|round }}%"></div>
        <div class="bg-masters-gold h-full" style="width: {{ (team2_points / total * 100)|round }}%"></div>
    </div>
    {% endif %}
</a>
{% endif %}

<!-- Stats Row -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <div class="glass rounded-2xl p-6 card-hover border border-gray-100">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium">Total Players</p>
                <p class="text-3xl font-bold text-masters-green mt-1">{{ players|length }}</p>
            </div>
            <div class="w-12 h-12 rounded-xl gradient-bg flex items-center justify-center">
                <i class="fas fa-users text-white"></i>
            </div>
        </div>
    </div>
    
    <div class="glass rounded-2xl p-6 card-hover border border-gray-100">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium">Avg Handicap</p>
                <p class="text-3xl font-bold text-masters-green mt-1">
                    {% if players %}{{ "%.1f"|format(players|map(attribute='handicap')|list|sum / players|length) }}{% else %}--{% endif %}
                </p>
            </div>
            <div class="w-12 h-12 rounded-xl gold-gradient flex items-center justify-center">
                <i class="fas fa-chart-line text-white"></i>
            </div>
        </div>
    </div>
    
    <div class="glass rounded-2xl p-6 card-hover border border-gray-100">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium">Courses</p>
                <p class="text-3xl font-bold text-masters-green mt-1">{{ courses|length if courses is defined else 0 }}</p>
            </div>
            <div class="w-12 h-12 rounded-xl gradient-bg flex items-center justify-center">
                <i class="fas fa-flag text-white"></i>
            </div>
        </div>
    </div>
    
    <div class="glass rounded-2xl p-6 card-hover border border-gray-100">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium">Rounds Played</p>
                <p class="text-3xl font-bold text-masters-green mt-1">{{ rounds|length if rounds is defined else 0 }}</p>
            </div>
            <div class="w-12 h-12 rounded-xl gold-gradient flex items-center justify-center">
                <i class="fas fa-golf-ball text-white"></i>
            </div>
        </div>
    </div>
</div>

<!-- Teams Section -->
{% set team_names = agenda.get_team_names_list() %}
{% if team_names|length >= 2 %}
<div class="grid md:grid-cols-2 gap-6 mb-8">
    <!-- Team 1 -->
    <div class="glass rounded-2xl overflow-hidden border border-gray-100 card-hover">
        <div class="gradient-bg px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white"></i>
                    </div>
                    <h3 class="text-white font-bold text-xl">{{ team_names[0] }}</h3>
                </div>
                <div class="text-white/80 text-sm">
                    {{ players|selectattr('team', 'equalto', team_names[0])|list|length }} players
                </div>
            </div>
        </div>
        <div class="p-4">
            {% set team1_players = players|selectattr('team', 'equalto', team_names[0])|list %}
            {% if team1_players %}
                <div class="space-y-2">
                    {% for player in team1_players %}
                    <div class="flex items-center justify-between p-3 rounded-xl hover:bg-gray-50 transition-all">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center text-white font-bold">
                                {{ player.name[0] }}
                            </div>
                            <div>
                                <span class="font-semibold text-gray-800">{{ player.name }}</span>
                                {% if player.is_captain %}
                                <span class="ml-2 text-masters-gold" title="Captain"><i class="fas fa-crown"></i></span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-500">HCP {{ player.handicap }}</span>
                            <a href="{{ url_for('edit_player', player_id=player.id) }}" class="text-gray-400 hover:text-masters-green transition-colors">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-400 text-center py-6">No players assigned yet</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Team 2 -->
    <div class="glass rounded-2xl overflow-hidden border border-gray-100 card-hover">
        <div class="gold-gradient px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white"></i>
                    </div>
                    <h3 class="text-white font-bold text-xl">{{ team_names[1] }}</h3>
                </div>
                <div class="text-white/80 text-sm">
                    {{ players|selectattr('team', 'equalto', team_names[1])|list|length }} players
                </div>
            </div>
        </div>
        <div class="p-4">
            {% set team2_players = players|selectattr('team', 'equalto', team_names[1])|list %}
            {% if team2_players %}
                <div class="space-y-2">
                    {% for player in team2_players %}
                    <div class="flex items-center justify-between p-3 rounded-xl hover:bg-gray-50 transition-all">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full gold-gradient flex items-center justify-center text-white font-bold">
                                {{ player.name[0] }}
                            </div>
                            <div>
                                <span class="font-semibold text-gray-800">{{ player.name }}</span>
                                {% if player.is_captain %}
                                <span class="ml-2 text-masters-gold" title="Captain"><i class="fas fa-crown"></i></span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-500">HCP {{ player.handicap }}</span>
                            <a href="{{ url_for('edit_player', player_id=player.id) }}" class="text-gray-400 hover:text-masters-green transition-colors">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-400 text-center py-6">No players assigned yet</p>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- Unassigned Players -->
{% set unassigned = players|rejectattr('team')|list %}
{% if unassigned %}
<div class="glass rounded-2xl p-6 border border-gray-100 mb-8">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-gray-800">
            <i class="fas fa-user-clock mr-2 text-gray-400"></i>Unassigned Players
        </h3>
        <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-sm">{{ unassigned|length }} waiting</span>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
        {% for player in unassigned %}
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-bold">
                    {{ player.name[0] }}
                </div>
                <div>
                    <span class="font-semibold text-gray-800">{{ player.name }}</span>
                    <p class="text-xs text-gray-500">HCP {{ player.handicap }}</p>
                </div>
            </div>
            <a href="{{ url_for('edit_player', player_id=player.id) }}" class="text-masters-green hover:text-masters-dark transition-colors">
                <i class="fas fa-user-plus"></i>
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div class="glass rounded-2xl p-6 border border-gray-100 mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-6">
        <i class="fas fa-bolt mr-2 text-masters-gold"></i>Quick Actions
    </h3>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <a href="{{ url_for('create_match') }}" class="flex flex-col items-center p-6 rounded-xl bg-gray-50 hover:bg-masters-gold hover:text-white transition-all group">
            <div class="w-14 h-14 rounded-full bg-masters-gold/10 group-hover:bg-white/20 flex items-center justify-center mb-3 transition-all">
                <i class="fas fa-trophy text-2xl text-masters-gold group-hover:text-white transition-colors"></i>
            </div>
            <span class="font-semibold text-center">New Match</span>
        </a>
        
        <a href="{{ url_for('add_player') }}" class="flex flex-col items-center p-6 rounded-xl bg-gray-50 hover:bg-masters-green hover:text-white transition-all group">
            <div class="w-14 h-14 rounded-full bg-masters-green/10 group-hover:bg-white/20 flex items-center justify-center mb-3 transition-all">
                <i class="fas fa-user-plus text-2xl text-masters-green group-hover:text-white transition-colors"></i>
            </div>
            <span class="font-semibold text-center">Add Player</span>
        </a>
        
        <a href="{{ url_for('travel') }}" class="flex flex-col items-center p-6 rounded-xl bg-gray-50 hover:bg-masters-green hover:text-white transition-all group">
            <div class="w-14 h-14 rounded-full bg-masters-green/10 group-hover:bg-white/20 flex items-center justify-center mb-3 transition-all">
                <i class="fas fa-plane text-2xl text-masters-green group-hover:text-white transition-colors"></i>
            </div>
            <span class="font-semibold text-center">Travel Plans</span>
        </a>
        
        <a href="{{ url_for('rounds') }}" class="flex flex-col items-center p-6 rounded-xl bg-gray-50 hover:bg-masters-green hover:text-white transition-all group">
            <div class="w-14 h-14 rounded-full bg-masters-green/10 group-hover:bg-white/20 flex items-center justify-center mb-3 transition-all">
                <i class="fas fa-flag text-2xl text-masters-green group-hover:text-white transition-colors"></i>
            </div>
            <span class="font-semibold text-center">Log Round</span>
        </a>
        
        <a href="{{ url_for('add_expense') }}" class="flex flex-col items-center p-6 rounded-xl bg-gray-50 hover:bg-masters-green hover:text-white transition-all group">
            <div class="w-14 h-14 rounded-full bg-masters-green/10 group-hover:bg-white/20 flex items-center justify-center mb-3 transition-all">
                <i class="fas fa-receipt text-2xl text-masters-green group-hover:text-white transition-colors"></i>
            </div>
            <span class="font-semibold text-center">Add Expense</span>
        </a>
    </div>
</div>

<!-- Recent Announcements -->
{% if announcements %}
<div class="glass rounded-2xl p-6 border border-gray-100 mb-8">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-gray-800">
            <i class="fas fa-bullhorn mr-2 text-masters-green"></i>Latest News
        </h3>
        <a href="{{ url_for('announcements') }}" class="text-masters-green hover:text-masters-dark font-medium text-sm">
            View All â†’
        </a>
    </div>
    <div class="space-y-4">
        {% for announcement in announcements %}
        <div class="p-4 bg-gray-50 rounded-xl {% if announcement.pinned %}border-l-4 border-masters-gold{% endif %}">
            <div class="flex items-center space-x-2 mb-1">
                {% if announcement.pinned %}
                <span class="text-masters-gold text-xs"><i class="fas fa-thumbtack"></i></span>
                {% endif %}
                <h4 class="font-bold text-gray-800">{{ announcement.title }}</h4>
            </div>
            <p class="text-gray-600 text-sm line-clamp-2">{{ announcement.content[:150] }}{% if announcement.content|length > 150 %}...{% endif %}</p>
            <p class="text-gray-400 text-xs mt-2">{{ announcement.created_at.strftime('%b %d') }}{% if announcement.author %} â€¢ {{ announcement.author }}{% endif %}</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Message Section -->
{% if agenda.message %}
<div class="glass rounded-2xl p-6 border border-gray-100">
    <div class="flex items-start space-x-4">
        <div class="w-12 h-12 rounded-full gradient-bg flex items-center justify-center flex-shrink-0">
            <i class="fas fa-bullhorn text-white"></i>
        </div>
        <div>
            <h3 class="font-bold text-gray-800 mb-2">From the Commissioner</h3>
            <p class="text-gray-600 leading-relaxed">{{ agenda.message }}</p>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
    // Countdown Timer
    function updateCountdown() {
        // Trip starts August 19, 2026
        const targetDate = new Date('August 19, 2026');
        
        const now = new Date();
        const diff = targetDate - now;
        
        if (diff <= 0) {
            document.getElementById('days').textContent = 'ðŸŒï¸';
            document.getElementById('hours').textContent = 'IT\'S';
            document.getElementById('minutes').textContent = 'GO';
            document.getElementById('seconds').textContent = 'TIME!';
            return;
        }
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        document.getElementById('days').textContent = String(days).padStart(2, '0');
        document.getElementById('hours').textContent = String(hours).padStart(2, '0');
        document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
        document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
    }
    
    updateCountdown();
    setInterval(updateCountdown, 1000);
</script>
{% endblock %}
